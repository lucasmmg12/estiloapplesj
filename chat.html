<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Chat - Grow Labs</title>
    <link rel="icon" type="image/png" href="public/logogrow.png">
    <link rel="stylesheet" href="chat.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar: Contact List -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <div class="user-avatar">
                    <img src="public/logogrow.png" alt="Perfil" id="userAvatar">
                </div>
                <div class="header-actions">
                    <button class="icon-btn" title="Nuevo Chat">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <button class="icon-btn" title="Refrescar" onclick="location.reload()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="search-bar">
                <div class="search-input-container">
                    <svg viewBox="0 0 24 24" width="24" height="24" class="search-icon">
                        <path fill="currentColor"
                            d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.254l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.008zm-4.814 0a3.606 3.606 0 1 1 0-7.212 3.606 3.606 0 0 1 0 7.212z">
                        </path>
                    </svg>
                    <input type="text" placeholder="Buscar cliente..." id="searchInput">
                </div>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">Todos</button>
                <button class="filter-tab" data-filter="unread">No leídos</button>
                <button class="filter-tab" data-filter="favorites">Favoritos</button>
            </div>

            <div class="contacts-list" id="contactsList">
                <!-- Los contactos se cargarán aquí dinámicamente -->
                <div class="loading-contacts">
                    <div class="spinner"></div>
                    <p>Iniciando sistema...</p>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area" id="chatArea">
            <!-- Empty State (No chat selected) -->
            <div class="empty-state" id="emptyState">
                <div class="empty-welcome-card">
                    <div class="empty-logo"></div>
                    <h2>Grow Labs Live</h2>
                    <p>Gestión de mensajes en tiempo real.<br>Responde a tus clientes con la velocidad del neón.</p>
                    <div class="encrypted-msg">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="var(--primary-green)">
                            <path
                                d="M18 8H6V7c0-2.8 2.2-5 5-5s5 2.2 5 5v1h2V7c0-3.9-3.1-7-7-7S4 3.1 4 7v1H2v14h20V8h-2zM6 7c0-2.8 2.2-5 5-5s5 2.2 5 5v1H6V7z">
                            </path>
                        </svg>
                        Conexión segura y encriptada
                    </div>
                </div>
            </div>

            <!-- Active Chat View (Hidden by default) -->
            <div class="active-chat" id="activeChat" style="display: none;">
                <header class="chat-header">
                    <div class="chat-info">
                        <div class="chat-avatar" id="chatHeaderAvatar"></div>
                        <div class="chat-details">
                            <h3 id="chatHeaderName">Nombre Cliente</h3>
                            <span id="chatHeaderStatus">en línea</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" title="Buscar">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path fill="currentColor"
                                    d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.254l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.008zm-4.814 0a3.606 3.606 0 1 1 0-7.212 3.606 3.606 0 0 1 0 7.212z">
                                </path>
                            </svg>
                        </button>
                        <button class="icon-btn" title="Opciones" onclick="openEditModal('${phone}')">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path
                                    d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                            </svg>
                        </button>
                    </div>
                </header>

                <div class="messages-container" id="messagesContainer">
                    <!-- Los mensajes se cargarán aquí -->
                </div>

                <footer class="chat-input-area">
                    <button class="icon-btn" title="Emojis">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path
                                d="M9.153 11.603c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962zm-3.204 1.362c-.026-.307-.131 5.218 6.063 5.551 6.066-.25 6.066-5.551 6.066-5.551-6.078 1.416-12.129 0-12.129 0zm11.363 1.108s-.669 1.959-5.051 1.959c-3.505 0-5.388-1.164-5.607-1.959 0 0 5.912 1.055 10.658 0zM11.804 1.011C5.609 1.011.978 6.033.978 12.228s4.826 10.761 11.021 10.761S23.02 18.423 23.02 12.228c.001-6.195-5.021-11.217-11.216-11.217zM12 21.354c-5.273 0-9.381-3.886-9.381-9.159s3.942-9.548 9.215-9.548 9.548 4.275 9.548 9.548c-.001 5.272-4.109 9.159-9.382 9.159zm3.108-9.751c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962z">
                            </path>
                        </svg>
                    </button>
                    <button class="icon-btn" title="Adjuntar">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path
                                d="M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z">
                            </path>
                        </svg>
                    </button>
                    <div class="input-wrapper">
                        <input type="text" placeholder="Escribe un mensaje aquí" id="messageInput">
                    </div>
                    <button class="btn-send" id="btnSend" title="Enviar Mensaje">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path
                                d="M1.101 21.757 23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z">
                            </path>
                        </svg>
                    </button>
                </footer>
            </div>
            <!-- Edit Client Modal -->
            <div class="modal-overlay" id="editClientModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Editar Cliente</h2>
                        <button class="close-modal" onclick="closeEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="editClientForm">
                            <input type="hidden" id="editPhone">

                            <div class="form-group">
                                <label>Nombre</label>
                                <input type="text" id="editName" placeholder="Ej: Juan Pérez">
                            </div>

                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="editEmail" placeholder="cliente@email.com">
                            </div>

                            <div class="form-group">
                                <label>Dispositivo</label>
                                <input type="text" id="editDevice" placeholder="Ej: iPhone 14 Pro Max">
                            </div>

                            <div class="form-group">
                                <label>Vendedor Asignado</label>
                                <input type="text" id="editSeller" placeholder="Nombre del vendedor">
                            </div>

                            <div class="form-group">
                                <label>Avatar (URL de Imagen)</label>
                                <input type="text" id="editAvatar" placeholder="https://ejemplo.com/imagen.jpg">
                            </div>

                            <div class="form-group">
                                <label>Categoría / Interés</label>
                                <select id="editInterest">
                                    <option value="">Seleccionar...</option>
                                    <option value="Comprar">Comprar</option>
                                    <option value="Averiguar">Averiguar</option>
                                    <option value="Reparar">Reparar</option>
                                    <option value="Canjear">Canjear</option>
                                    <option value="Servicio Técnico">Servicio Técnico</option>
                                    <option value="Consulta General">Consulta General</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Notas</label>
                                <textarea id="editNotes" rows="3"
                                    placeholder="Detalles importantes del cliente..."></textarea>
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancelar</button>
                                <button type="submit" class="btn-save">Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module" src="chat-client.js"></script>
</body>

</html>